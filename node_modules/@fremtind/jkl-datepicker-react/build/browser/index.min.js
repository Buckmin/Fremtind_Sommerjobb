import e,{forwardRef as t,useState as r,useRef as n,useEffect as a,useCallback as l}from"react";import o from"crypto";import{Label as i,SupportLabel as c}from"@fremtind/jkl-core";import{TextInput as d,BaseInputField as u}from"@fremtind/jkl-text-input-react";import{useAnimatedHeight as s,useClickOutside as p,useKeyListener as f}from"@fremtind/jkl-react-hooks";import{IconButton as m}from"@fremtind/jkl-icon-button-react";import v from"@nrk/core-datepicker/jsx";import{NativeSelect as b}from"@fremtind/jkl-select-react";function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function k(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw l}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}let g={},_=(e=21)=>{let t=(e=>{let t=g[e];return t||(t=Buffer.allocUnsafe(e),e<=255&&(g[e]=t)),o.randomFillSync(t)})(e),r="";for(;e--;)r+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[63&t[e]];return r};var w=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){var t={}.hasOwnProperty;function r(){for(var e=[],n=0;n<arguments.length;n++){var a=arguments[n];if(a){var l=typeof a;if("string"===l||"number"===l)e.push(a);else if(Array.isArray(a)&&a.length){var o=r.apply(null,a);o&&e.push(o)}else if("object"===l)for(var i in a)t.call(a,i)&&a[i]&&e.push(i)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r}()})),E=(w.named,t((function(t,r){var n=t.hidden,a=t.extended,l=t.forceCompact,o=t.inverted,i=t.onClickDate,c=t.currentDate,u=t.monthLabel,s=void 0===u?"Måned":u,p=t.yearLabel,f=void 0===p?"År":p,m=t.days,h=t.months,k=t.disableDate,y=w("jkl-calendar",{"jkl-calendar--hidden":n,"jkl-calendar--extended":a,"jkl-calendar--inverted":o});return e.createElement(v,{timestamp:c?c.getTime():new Date,months:h,days:m,onDatepickerClickDay:i,disabled:k,forwardRef:r,className:y},e.createElement("div",{className:"jkl-calendar__padding"},a&&e.createElement("div",{className:"jkl-calendar__navigation"},e.createElement(d,{inverted:o,label:f,type:"year",className:"jkl-calendar__year-selector",width:"5rem",variant:"small",forceCompact:l}),e.createElement(b,{inverted:o,className:"jkl-calendar__month-selector",label:s,items:[],variant:"small",forceCompact:l})),!a&&e.createElement("fieldset",{className:"jkl-calendar__month-navigation"},e.createElement("button",{title:"forrige måned","aria-label":"forrige måned",className:"jkl-calendar__month-button",value:"- 1 month"},"←"),e.createElement("button",{title:"neste måned","aria-label":"neste måned",className:"jkl-calendar__month-button jkl-calendar__month-button--right",value:"+ 1 month"},"→")),e.createElement("table",{"data-testid":"jkl-datepicker-calendar"})))})));E.displayName="Calendar";var C=/^(\d\d)\.(\d\d)\.(\d{4})/;function D(e){var t="".concat(e.getDate()).padStart(2,"0"),r="".concat(e.getMonth()+1).padStart(2,"0");return"".concat(t,".").concat(r,".").concat(e.getFullYear())}function N(t){var o=t.label,d=void 0===o?"Velg dato":o,v=t.placeholder,b=void 0===v?"dd.mm.åååå":v,j=t.calendarButtonTitle,g=t.showCalendarLabel,N=void 0===g?j||"Åpne kalender":g,x=t.hideCalendarLabel,L=void 0===x?j||"Lukk kalender":x,O=t.initialDate,S=t.onChange,A=t.onBlur,B=t.onFocus,T=t.initialShow,F=void 0!==T&&T,I=t.className,M=void 0===I?"":I,P=t.forceCompact,Y=t.inverted,R=t.disableBeforeDate,U=t.disableAfterDate,V=t.variant,q=t.helpLabel,G=t.errorLabel,H=k(t,["label","placeholder","calendarButtonTitle","showCalendarLabel","hideCalendarLabel","initialDate","onChange","onBlur","onFocus","initialShow","className","forceCompact","inverted","disableBeforeDate","disableAfterDate","variant","helpLabel","errorLabel"]);j&&"production"!==process.env.NODE_ENV&&console.warn("WARNING: For better usability, please supply separate button titles for showing/hiding the calendar, using the showCalendarLabel and hideCalendarLabel props respectively. The calendarButtonTitle prop is deprecated and will be removed in a future update.");var W=y(r("jkl-datepicker-".concat(_(8))),1)[0],z=y(r("jkl-support-label-".concat(_(8))),1)[0],J=y(r(O),2),K=J[0],Q=J[1],X=y(r(!F),2),Z=X[0],$=X[1],ee=y(r(O?D(O):""),2),te=ee[0],re=ee[1],ne=w("jkl-datepicker",{"jkl-datepicker--open":!Z,"jkl-datepicker--inverted":Y},M),ae=w("jkl-datepicker__input-wrapper jkl-text-input__input-wrapper",{"jkl-text-input--compact":P,"jkl-text-input--inverted":Y}),le=n(null),oe=n(null),ie=y(s(!Z),1)[0];p(ie,(function(){!Z&&$(!0)})),f(ie,["Escape"],(function(){!Z&&$(!0),oe.current&&oe.current.focus()})),a((function(){U&&U.setHours(23,59,59,999);var e=new Date;U&&e>U&&Q(U),R&&e<R&&Q(R)}),[R,U]),a((function(){re(O?D(O):""),Q(O)}),[O]);var ce=l((function(){return $(!Z)}),[Z]);a((function(){var e=oe.current;return e&&e.addEventListener("click",ce),function(){e&&e.removeEventListener("click",ce)}}),[ce]);var de=function(e){var t=le.current&&le.current.contains(e.relatedTarget);A&&!t&&A(K)},ue=function(e){var t=le.current&&le.current.contains(e.relatedTarget);B&&!t&&B(K)};function se(e,t){return!(e&&(r=e,n=t,r.getDate()===n.getDate()&&r.getMonth()===n.getMonth()&&r.getFullYear()===n.getFullYear()));var r,n}return e.createElement("div",{className:ne,ref:le},e.createElement(i,{standAlone:!0,htmlFor:W,variant:V},d),e.createElement("div",{className:ae},e.createElement(u,{ref:oe,id:W,describedBy:z,invalid:!!G,className:"jkl-datepicker__input jkl-text-input__input","data-testid":"jkl-datepicker__input",value:te,onFocus:ue,onBlur:de,onChange:function(e){var t=e.target.value,r=function(e){var t=C.exec(e);if(t){var r=parseInt(t[1],10),n=parseInt(t[2],10)-1,a=parseInt(t[3],10);return new Date(a,n,r,0,0,0)}}(t);r&&se(K,r)?(Q(r),S&&S(r)):""===t&&(Q(void 0),S&&S(void 0)),re(t)},placeholder:b,width:"11.5rem"}),e.createElement(m,{className:"jkl-text-input__action-button",iconType:"calendar",buttonTitle:Z?N:L,onClick:function(){var e=Z;if($(!Z),e){var t=ie.current,r=t&&t.querySelector("[autofocus]");r&&setTimeout((function(){return r.focus()}),100)}},onFocus:ue,onBlur:de}),e.createElement("div",{className:"jkl-datepicker__calendar-wrapper"},e.createElement(E,h({currentDate:K,onClickDate:function(e){var t=e.target.date;se(K,t)&&(re(D(t)),Q(t),S&&S(t)),$(!0),oe.current&&oe.current.focus()},disableDate:function(e){return U&&e>U||R&&e<R},hidden:Z,inverted:Y,forceCompact:P,ref:ie},H)))),e.createElement(c,{inverted:Y,id:z,helpLabel:q,errorLabel:G}))}export{N as DatePicker};
