{"version":3,"file":"core-toggle.jsx.js","sources":["../utils.js","core-toggle.js","../../node_modules/@nrk/custom-element-to-react/lib/custom-element-to-react.mjs","core-toggle.jsx"],"sourcesContent":["export const IS_BROWSER = typeof window !== 'undefined'\nexport const IS_ANDROID = IS_BROWSER && /(android)/i.test(navigator.userAgent) // Bad, but needed\nexport const IS_IOS = IS_BROWSER && /iPad|iPhone|iPod/.test(String(navigator.platform))\n\n// Mock HTMLElement for Node\nif (!IS_BROWSER && !global.HTMLElement) {\n  global.HTMLElement = class {}\n}\n\n/**\n* addEvent\n* @param {String} nodeName An unique ID of the event to bind - ensurnes single instance\n* @param {String} type The type of event to bind\n* @param {Function} handler The function to call on event\n* @param {Boolean|Object} options useCapture or options object for addEventListener. Defaults to false\n*/\nexport function addEvent (nodeName, type, handler, options = false, key) {\n  if (!IS_BROWSER || window[key = `event-${nodeName}-${type}`]) return // Ensure single instance\n  const node = (type === 'resize' || type === 'load') ? window : document\n  node.addEventListener(window[key] = type, (event) => (event.nodeName = nodeName) && handler(event), options)\n}\n\n/**\n* addStyle\n* @param {String} nodeName An unique ID of the event to bind - ensurnes single instance\n* @param {String} css The css to inject\n*/\nexport function addStyle (nodeName, css) {\n  const key = `style-${nodeName.toLowerCase()}`\n  const min = css.replace(/\\/\\*[^!][^*]*\\*\\//g, '').replace(/\\s*(^|[:;,{}]|$)\\s*/g, '$1')\n  document.getElementById(key) || document.head.insertAdjacentHTML('afterbegin', `<style id=\"${key}\">${min}</style>`)\n}\n\n/**\n* escapeHTML\n* @param {String} str A string with potential html tokens\n* @return {String} Escaped HTML string according to OWASP recommendation\n*/\nconst ESCAPE_MAP = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', '/': '&#x2F;', '\\'': '&#x27;' }\nexport function escapeHTML (str) {\n  return String(str || '').replace(/[&<>\"'/]/g, (char) => ESCAPE_MAP[char])\n}\n\n/**\n* closest\n* @param {Element} element Element to traverse up from\n* @param {String} selector A selector to search for matching parents or element itself\n* @return {Element|null}  Element which is the closest ancestor matching selector\n*/\nexport const closest = (() => {\n  const proto = typeof window === 'undefined' ? {} : window.Element.prototype\n  const match = proto.matches || proto.msMatchesSelector || proto.webkitMatchesSelector\n  return proto.closest ? (el, css) => el.closest(css) : (el, css) => {\n    // IE jumps to shadow SVG DOM on clicking an SVG defined by <use>.\n    // If so, jump back to <use> element and traverse real DOM\n    if (el.correspondingUseElement) el = el.correspondingUseElement\n    for (;el; el = el.parentElement) if (match.call(el, css)) return el\n    return null\n  }\n})()\n\n/**\n* dispatchEvent - with infinite loop prevention\n* @param {Element} elem The target object\n* @param {String} name The source object(s)\n* @param {Object} detail Detail object (bubbles and cancelable is set to true)\n* @return {Boolean} Whether the event was canceled\n*/\nexport function dispatchEvent (element, name, detail = {}) {\n  const ignore = `prevent_recursive_dispatch_maximum_callstack${name}`\n  let event\n\n  if (element[ignore]) return true // We are already processing this event, so skip sending a new one\n  else element[ignore] = true // Add name to dispatching ignore\n\n  if (typeof window.CustomEvent === 'function') {\n    event = new window.CustomEvent(name, { bubbles: true, cancelable: true, detail })\n  } else {\n    event = document.createEvent('CustomEvent')\n    event.initCustomEvent(name, true, true, detail)\n  }\n  // IE reports incorrect event.defaultPrevented\n  // but correct return value on element.dispatchEvent\n  const result = element.dispatchEvent(event)\n  element[ignore] = null // Remove name from dispatching ignore\n\n  return result // Follow W3C standard for return value\n}\n\n/**\n* getUUID\n* @return {String} A generated unique ID\n*/\nexport function getUUID () {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2, 5)\n}\n\n/**\n * throttle\n * @param {Function} callback  The new throttled function\n * @param {Number} ms The threshold of milliseconds between each callback\n */\nexport function throttle (callback, ms) {\n  let timer\n  return function (...args) {\n    if (!timer) {\n      timer = setTimeout(function () {\n        callback.apply(this, args)\n        timer = null\n      }, ms)\n    }\n  }\n}\n\n/**\n * toggleAttribute (Ponyfill for IE and Edge, fixes #299)\n * @link https://developer.mozilla.org/en-US/docs/Web/API/Element/toggleAttribute\n * @param {Element} el  Single DOM Element\n * @param {String} name The name of the attribute to be toggled\n * @param {Boolean} force Force attribute to be added or removed regardless of previous state\n */\nexport function toggleAttribute (el, name, force = !this.hasAttribute(name)) {\n  if (!force === el.hasAttribute(name)) el[force ? 'setAttribute' : 'removeAttribute'](name, '')\n  return force\n}\n\n/**\n* queryAll\n* @param {String|NodeList|Array|Element} elements A CSS selector string, nodeList, element array, or single element\n* @param {Element} context Node to look for elements within\n* @return {Element[]} Array of elements\n*/\nexport function queryAll (elements, context = document) {\n  if (elements) {\n    if (elements.nodeType) return [elements]\n    if (typeof elements === 'string') return [].slice.call(context.querySelectorAll(elements))\n    if (elements.length) return [].slice.call(elements)\n  }\n  return []\n}\n","import { IS_ANDROID, IS_IOS, closest, dispatchEvent, getUUID, toggleAttribute } from '../utils'\n\nexport default class CoreToggle extends HTMLElement {\n  static get observedAttributes () { return ['hidden'] }\n\n  connectedCallback () {\n    if (IS_IOS) document.documentElement.style.cursor = 'pointer' // Fix iOS events for closing popups (https://stackoverflow.com/a/16006333/8819615)\n    if (!IS_ANDROID) this.setAttribute('aria-labelledby', this.button.id = this.button.id || getUUID()) // Andriod reads only label instead of content\n\n    this.value = this.button.textContent // Set up aria-label\n    this.setAttribute('role', 'group') // Help Edge\n    this.button.setAttribute('aria-expanded', this._open = !this.hidden)\n    this.button.setAttribute('aria-controls', this.id = this.id || getUUID())\n    document.addEventListener('keydown', this, true) // Use capture to enable checking defaultPrevented (from ESC key) in parents\n    document.addEventListener('click', this)\n  }\n\n  disconnectedCallback () {\n    this._button = null\n    document.removeEventListener('keydown', this, true)\n    document.removeEventListener('click', this)\n  }\n\n  attributeChangedCallback () {\n    if (this._open === this.hidden) { // this._open comparison ensures actual change\n      this.button.setAttribute('aria-expanded', this._open = !this.hidden)\n      try { this.querySelector('[autofocus]').focus() } catch (err) {}\n      dispatchEvent(this, 'toggle')\n    }\n  }\n\n  handleEvent (event) {\n    if (event.defaultPrevented) return\n    if (event.type === 'keydown' && event.keyCode === 27) {\n      const isButton = event.target.getAttribute && event.target.getAttribute('aria-expanded') === 'true'\n      const isHiding = isButton ? event.target === this.button : closest(event.target, this.nodeName) === this\n      if (isHiding) {\n        this.hidden = true\n        this.button.focus() // Move focus back to button\n        return event.preventDefault() // Prevent closing maximized Safari and other coreToggles\n      }\n    }\n    if (event.type === 'click') {\n      const btn = closest(event.target, 'a,button')\n      if (btn && !btn.hasAttribute('aria-expanded') && closest(event.target, this.nodeName) === this) dispatchEvent(this, 'toggle.select', btn)\n      else if (btn && btn.getAttribute('aria-controls') === this.id) this.hidden = !this.hidden\n      else if (this.popup && !this.contains(event.target)) this.hidden = true // Click in content or outside\n    }\n  }\n\n  get button () {\n    if (this._button && this._button.getAttribute('for') === this.id) return this._button // Speed up\n    return (this._button = this.id && document.querySelector(`[for=\"${this.id}\"]`)) || this.previousElementSibling\n  }\n\n  // aria-haspopup triggers forms mode in JAWS, therefore store as custom attr\n  get popup () { return this.getAttribute('popup') === 'true' || this.getAttribute('popup') || this.hasAttribute('popup') }\n\n  set popup (val) { this[val === false ? 'removeAttribute' : 'setAttribute']('popup', val) }\n\n  // Must set attribute for IE11\n  get hidden () { return this.hasAttribute('hidden') }\n\n  set hidden (val) { toggleAttribute(this, 'hidden', val) }\n\n  // Sets this.button aria-label, so visible button text can be augmentet with intension of button\n  // Example: Button text: \"01.02.2019\", aria-label: \"01.02.2019, Choose date\"\n  // Does not updates aria-label if not allready set to something else than this.popup\n  get value () { return this.button.value || this.button.textContent }\n\n  set value (data = false) {\n    if (!this.button || !this.popup.length) return\n    const button = this.button\n    const popup = (button.getAttribute('aria-label') || `,${this.popup}`).split(',')[1]\n    const label = data.textContent || data || '' // data can be Element, Object or String\n\n    if (popup === this.popup) {\n      button.value = data.value || label\n      button[data.innerHTML ? 'innerHTML' : 'textContent'] = data.innerHTML || label\n      button.setAttribute('aria-label', `${button.textContent},${this.popup}`)\n    }\n  }\n}\n","import React from 'react';\n\n/**\n* closest\n* @param {Element} el Element to traverse up from\n* @param {String} css A selector to search for matching parents or element itself\n* @return {Element|null}  Element which is the closest ancestor matching selector\n*/\nvar closest = (function () {\n  var proto = typeof window === 'undefined' ? {} : window.Element.prototype;\n  var match = proto.matches || proto.msMatchesSelector || proto.webkitMatchesSelector;\n  return proto.closest ? function (el, css) { return el.closest(css); } : function (el, css) {\n    for (;el; el = el.parentElement) { if (match.call(el, css)) { return el } }\n    return null\n  }\n})();\n\n/**\n* customElementToReact\n* @param {Class|Function} elementClass A custom element definition.\n* @param {Array} options Props and custom events\n* @return {Object} A React component\n*/\nfunction customElementToReact (elementClass, options) {\n  if ( options === void 0 ) options = {};\n\n  var name = elementClass.name || String(elementClass).match(/function ([^(]+)/)[1]; // String match for IE11\n  var dashCase = name.replace(/.[A-Z]/g, function (ref) {\n    var a = ref[0];\n    var b = ref[1];\n\n    return (a + \"-\" + b);\n  }); // NameName -> name-name\n  var customProps = options.props || [];\n  var customEvents = options.customEvents || [];\n  var eventMap = customEvents.reduce(function (map, eventName) {\n    map[eventName] = \"on\" + (eventName.replace(/(^|\\.)./g, function (m) { return m.slice(-1).toUpperCase(); })); // input.filter => onInputFilter\n    return map\n  }, {});\n  var skipProps = customProps.concat('forwardRef', Object.keys(eventMap).map(function (onEventName) { return eventMap[onEventName]; }));\n  var tagName = (dashCase + \"-\" + (options.suffix || 'react')).replace(/\\W+/g, '-').toLowerCase();\n\n  return /*@__PURE__*/(function (superclass) {\n    function anonymous (props) {\n      var this$1 = this;\n\n      superclass.call(this, props);\n      // Register ref prop for accessing custom element https://reactjs.org/docs/refs-and-the-dom.html#callback-refs\n      this.ref = function (el) {\n        if (typeof this$1.props.forwardRef === 'function') { this$1.props.forwardRef(el); }\n        else if (this$1.props.forwardRef) { this$1.props.forwardRef.current = el; }\n        return (this$1.el = el)\n      };\n      // Register event handler on component for each custom event\n      Object.keys(eventMap).forEach(function (eventName) {\n        var onEventName = eventMap[eventName];\n        this$1[eventName] = function (event) {\n          if (this$1.props[onEventName] && closest(event.target, this$1.el.nodeName) === this$1.el) {\n            this$1.props[onEventName](event);\n          }\n        };\n      });\n    }\n\n    if ( superclass ) anonymous.__proto__ = superclass;\n    anonymous.prototype = Object.create( superclass && superclass.prototype );\n    anonymous.prototype.constructor = anonymous;\n\n    anonymous.prototype.componentDidMount = function componentDidMount () {\n      var this$1 = this;\n\n      // Run connectedCallback() after React componentDidMount() to allow React hydration to run first\n      if (!window.customElements.get(tagName)) {\n        window.customElements.define(tagName, elementClass);\n      }\n\n      // Populate properties on custom element\n      customProps.forEach(function (propName) {\n        if (propName in this$1.props) {\n          this$1.el[propName] = this$1.props[propName];\n        }\n      });\n\n      // Register events on custom element\n      customEvents.forEach(function (eventName) {\n        this$1.el.addEventListener(eventName, this$1[eventName]);\n      });\n    };\n\n    anonymous.prototype.componentDidUpdate = function componentDidUpdate (prev) {\n      var this$1 = this;\n\n      // Sync prop changes to custom element\n      customProps.forEach(function (propName) {\n        if (prev[propName] !== this$1.props[propName]) {\n          this$1.el[propName] = this$1.props[propName];\n        }\n      });\n    };\n\n    anonymous.prototype.componentWillUnmount = function componentWillUnmount () {\n      var this$1 = this;\n\n      // Remove event handlers on custom element on unmount\n      customEvents.forEach(function (eventName) {\n        this$1.el.removeEventListener(eventName, this$1[eventName]);\n      });\n    };\n\n    anonymous.prototype.render = function render () {\n      var this$1 = this;\n\n      // Convert React props to CustomElement props https://github.com/facebook/react/issues/12810\n      return React.createElement(tagName, Object.keys(this.props).reduce(function (thisProps, propName) {\n        if (skipProps.indexOf(propName) === -1) { // Do not render customEvents and custom props as attributes\n          if (propName === 'className') { thisProps.class = this$1.props[propName]; } // Fixes className for custom elements\n          else if (this$1.props[propName] === true) { thisProps[propName] = ''; } // Fixes boolean attributes\n          else if (this$1.props[propName] !== false) { thisProps[propName] = this$1.props[propName]; } // Pass only truthy, non-function props\n        }\n        return thisProps\n      }, { ref: this.ref }))\n    };\n\n    return anonymous;\n  }(React.Component))\n}\n\nexport default customElementToReact;\n","import CoreToggle from './core-toggle.js'\nimport { version } from './package.json'\nimport customElementToReact from '@nrk/custom-element-to-react'\n\nexport default customElementToReact(CoreToggle, {\n  customEvents: ['toggle', 'toggle.select'],\n  suffix: version\n})\n"],"names":["IS_BROWSER","window","IS_ANDROID","test","navigator","userAgent","IS_IOS","String","platform","global","HTMLElement","closest","proto","Element","prototype","match","matches","msMatchesSelector","webkitMatchesSelector","el","css","correspondingUseElement","parentElement","call","dispatchEvent","element","name","detail","ignore","event","CustomEvent","bubbles","cancelable","document","createEvent","initCustomEvent","result","getUUID","Date","now","toString","Math","random","slice","toggleAttribute","force","hasAttribute","CoreToggle","documentElement","style","cursor","setAttribute","button","id","value","textContent","_open","hidden","addEventListener","_button","removeEventListener","querySelector","focus","err","defaultPrevented","type","keyCode","isButton","target","getAttribute","isHiding","nodeName","preventDefault","btn","popup","contains","previousElementSibling","val","data","length","split","label","innerHTML","customElementToReact","elementClass","options","dashCase","replace","ref","a","b","customProps","props","customEvents","eventMap","reduce","map","eventName","m","toUpperCase","skipProps","concat","Object","keys","onEventName","tagName","suffix","toLowerCase","superclass","anonymous","this$1","forwardRef","current","forEach","__proto__","create","constructor","componentDidMount","customElements","get","define","propName","componentDidUpdate","prev","componentWillUnmount","render","React","createElement","thisProps","indexOf","Component","version"],"mappings":"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"}